"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TransactionManager = void 0;
const connectionmanager_1 = require("./connectionmanager");
const threadlocal_1 = require("./threadlocal");
/**
 * 事务管理器
 * @since 0.3.0
 */
class TransactionManager {
    /**
     * 添加事务
     * @param tx     transaction实例
     */
    static add(tx) {
        this.transactions.set(tx.threadId, tx);
        //因为已经修改theadId，需要把connection绑定到新threadid
        connectionmanager_1.ConnectionManager.addConnection(tx.threadId, tx.conn);
    }
    /**
     * 获取事务
     * @param threadId  thread id，默认为当前thread id
     * @returns         transaction实例 或 undefined
     */
    static get(threadId) {
        return this.transactions.get(threadId || threadlocal_1.RelaenThreadLocal.getThreadId());
    }
    /**
     * 删除事务
     * @param threadId  thread id，默认为当前thread id
     */
    static remove(threadId) {
        threadId || (threadId = threadlocal_1.RelaenThreadLocal.getThreadId());
        this.transactions.delete(threadId);
        connectionmanager_1.ConnectionManager.removeConnection(threadId);
    }
}
exports.TransactionManager = TransactionManager;
/**
 * 事务集合
 * key threadId,value 事务对象
 */
TransactionManager.transactions = new Map();
//# sourceMappingURL=transactionmanager.js.map